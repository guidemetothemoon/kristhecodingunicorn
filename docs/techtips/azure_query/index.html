<!DOCTYPE html>
<html
  dir="ltr"
  lang="en"
  data-theme="dark"
><head>
  <title>
    
      Kris - The Coding Unicorn
        |
        Power of --query in Azure CLI


      


    
  </title>

  
  <meta charset="utf-8" /><meta name="generator" content="Hugo 0.82.0" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta
    name="description"
    content="
      Let&#39;s take a look at how helpful query parameter can be in Azure CLI.


    "
  />
  
    <meta name="google-site-verification" content="OQXmc6vSYyn6I-aGZoI6GH2M6CdM4NjmwulDqvvNCQA" />
  
  
  <link
    rel="stylesheet"
    href="/css/main.min.a1e27bedb6c2b99cf038248b7e2261b55a4a5a3e86d97c4a7ff429f264fa939b.css"
    integrity="sha256-oeJ77bbCuZzwOCSLfiJhtVpKWj6G2XxKf/Qp8mT6k5s="
    crossorigin="anonymous"
    type="text/css"
  />
  
  
  <link
    rel="stylesheet"
    href="/css/markupHighlight.min.058b31f17db60602cc415fd63b0427e7932fbf35c70d8e341a4c39385f5f6f3e.css"
    integrity="sha256-BYsx8X22BgLMQV/WOwQn55MvvzXHDY40Gkw5OF9fbz4="
    crossorigin="anonymous"
    type="text/css"
  />
  
    
    
    <link
      rel="stylesheet"
      href="/css/syntax.min.d05334109c8eb1900492b0c2bd920b2e852c106609256ef7af7f61b59a76e817.css"
      integrity="sha256-0FM0EJyOsZAEkrDCvZILLoUsEGYJJW73r39htZp26Bc="
      crossorigin="anonymous"
      media="screen"
    />

  
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
    integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA=="
    crossorigin="anonymous"
  />
  
  <link rel="shortcut icon" href="/favicons/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png" />

  <link rel="canonical" href="https://kristhecodingunicorn.com/techtips/azure_query/" />

  
  
  
  
  <script
    type="text/javascript"
    src="/js/anatole-header.min.2a2cd9614b7d007dfbb75e8da19e3a0fa872ceab53c6d000c00b7a0c89b85bfc.js"
    integrity="sha256-KizZYUt9AH37t16NoZ46D6hyzqtTxtAAwAt6DIm4W/w="
    crossorigin="anonymous"
  ></script>

  
    
    
    <script
      type="text/javascript"
      src="/js/anatole-theme-switcher.min.7fd87181cdd7e8413aa64b6867bb32f3a8dc242e684fc7d5bbb9f600dbc2b6eb.js"
      integrity="sha256-f9hxgc3X6EE6pktoZ7sy86jcJC5oT8fVu7n2ANvCtus="
      crossorigin="anonymous"
    ></script>

  

  


  
  <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://kristhecodingunicorn.com/images/site-feature-image.png"/>

<meta name="twitter:title" content="Power of --query in Azure CLI"/>
<meta name="twitter:description" content="Let&#39;s take a look at how helpful query parameter can be in Azure CLI."/>



  


  
  
  
  
  <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "articleSection": "techtips",
        "name": "Power of --query in Azure CLI",
        "headline": "Power of --query in Azure CLI",
        "alternativeHeadline": "",
        "description": "
      Let\u0027s take a look at how helpful query parameter can be in Azure CLI.


    ",
        "inLanguage": "en",
        "isFamilyFriendly": "true",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/kristhecodingunicorn.com\/techtips\/azure_query\/"
        },
        "author" : {
            "@type": "Person",
            "name": "Kristina D."
        },
        "creator" : {
            "@type": "Person",
            "name": "Kristina D."
        },
        "accountablePerson" : {
            "@type": "Person",
            "name": "Kristina D."
        },
        "copyrightHolder" : {
            "@type": "Person",
            "name": "Kristina D."
        },
        "copyrightYear" : "2022",
        "dateCreated": "2022-02-13T00:00:00.00Z",
        "datePublished": "2022-02-13T00:00:00.00Z",
        "dateModified": "2022-02-13T00:00:00.00Z",
        "publisher":{
            "@type":"Organization",
            "name": "Kristina D.",
            "url": "https://kristhecodingunicorn.com",
            "logo": {
                "@type": "ImageObject",
                "url": "https:\/\/kristhecodingunicorn.com\/favicons\/favicon-32x32.png",
                "width":"32",
                "height":"32"
            }
        },
        "image": 
      [
        
        "https://kristhecodingunicorn.com/images/site-feature-image.png"


      
      ]

    ,
        "url" : "https:\/\/kristhecodingunicorn.com\/techtips\/azure_query\/",
        "wordCount" : "477",
        "genre" : [ ],
        "keywords" : [ 
      
      "techtips"

    
      
        ,

      
      "azure"

    
      
        ,

      
      "azure-cli"

    ]
    }
  </script>



</head>
<body>
    <header><div
  class="page-top 
    animated fadeInDown

  "
>
  <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
    <span aria-hidden="true"></span>
    <span aria-hidden="true"></span>
    <span aria-hidden="true"></span>
  </a>
  <nav>
    <ul class="nav__list" id="navMenu">
      <div class="nav__links">
        
        
          
          <li>
            <a
              
              href="/"
              
              title=""
              >Home</a
            >
          </li>

        
          
          <li>
            <a
              
              href="/blog/"
              
              title=""
              >Blog</a
            >
          </li>

        
          
          <li>
            <a
              
              href="/techtips/"
              
              title=""
              >Tech Tips</a
            >
          </li>

        
          
          <li>
            <a
              
              href="/public/"
              
              title=""
              >Public Talks and Publications</a
            >
          </li>

        
          
          <li>
            <a
              
              href="/about/"
              
              title=""
              >About</a
            >
          </li>

        
          
          <li>
            <a
              
              href="/contact/"
              
              title=""
              >Contact</a
            >
          </li>

        
      </div>
      <ul>
        
        
          <li>
            <a class="theme-switch" title="Switch Theme">
              <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a>
          </li>

        
      </ul>
    </ul>
  </nav>
</div>
</header>
    <div class="wrapper">
      <aside><div
  class="sidebar
    animated fadeInDown

  "
>
  <div class="sidebar__content">
    <div class="logo-title">
      <div class="title">
        <img src="/images/profile_new.jpg" alt="profile picture" />
        <h3 title=""><a href="/">Kris - The Coding Unicorn</a></h3>
        <div class="description">
          <p>Hey! I'm Kris and I like to code. Welcome to my tech corner!</p>
        </div>
      </div>
    </div>
    <ul class="social-links">
      
        <li>
          <a href="https://www.linkedin.com/in/krisde" rel="me" aria-label="Linkedin" title="Linkedin">
            <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
        <li>
          <a href="https://github.com/guidemetothemoon" rel="me" aria-label="GitHub" title="GitHub">
            <i class="fab fa-github fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
        <li>
          <a href="https://www.instagram.com/guidemetothemoon" rel="me" aria-label="instagram" title="instagram">
            <i class="fab fa-instagram fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
        <li>
          <a href="/contact/" rel="me" aria-label="e-mail" title="e-mail">
            <i class="fas fa-envelope fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
    </ul>
  </div><footer class="footer footer--sidebar">
  <div class="by_farbox">
    <ul class="footer__list">
      <li class="footer__item">
        &copy;
        
          2022 - Powered by Hugo

        
      </li>
      
    </ul>
  </div>
</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.71100d84fab0ad794b8399a66ac810700cc78d703f715dc10af4d7ba7b761362.js"
    integrity="sha256-cRANhPqwrXlLg5mmasgQcAzHjXA/cV3BCvTXunt2E2I="
    crossorigin="anonymous"
  ></script>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-RJTQCDFS2Q', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-RJTQCDFS2Q"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());
  gtag('config', 'G-RJTQCDFS2Q');
</script>
</div>
</aside>
      <main>
        <div class="autopagerize_page_element">
          <div class="content">
  <div
    class="post 
      animated fadeInDown

    "
  >
    <div class="post-content">
      
      <div class="post-title">
        <h1>Power of --query in Azure CLI</h1>
        
      </div><p>Have you ever heard of or used query parameter when running Azure CLI commands? If not, I do recommend you checking it out because this is a pretty powerful parameter that can help you with much faster and efficient data retrieval and filtering!
Let's use DNS records retrieval as an example: I need to update DNS records pointing to a specific IP, f.ex. <code>192.0.2.146</code>.</p>
<p>So, in order to retrieve all DNS records in respective DNS zone pointing to <code>192.0.2.146</code> with Azure CLI I could either:</p>
<ol>
<li>Retrieve all records registered in respective DNS zone and save them to a variable from which I can filter out only those records pointing to my IP.</li>
<li>Use <code>--query</code> parameter to retrieve only the DNS records pointing to my IP instead of retrieving all of the records at once.</li>
</ol>
<p>Let's see the execution time differences for both - I will use <code>Measure-Command</code> to measure the time it take to execute each of the approaches. The DNS zone I will be testing against has <strong>64 713</strong> records and I will be replacing real values with dummy ones in the test below since it's real name and IP are being used in production :)</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># Approach 1</span>
PS C:<span class="se">\P</span>layground&gt; Measure-Command <span class="o">{</span><span class="nv">$dns_list</span> <span class="o">=</span> az network dns record-set a list -g test-rg -z dev.testzone.com<span class="p">;</span> <span class="nv">$dns_recs</span> <span class="o">=</span> <span class="nv">$dns_list</span> <span class="p">|</span> ConvertFrom-Json -Depth <span class="m">4</span> <span class="p">|</span> Where-Object <span class="o">{</span><span class="nv">$_</span>.arecords.ipv4Address -eq <span class="s2">&#34;192.0.2.146&#34;</span><span class="o">}}</span>

Days              : <span class="m">0</span>
Hours             : <span class="m">0</span>
Minutes           : <span class="m">0</span>
Seconds           : <span class="m">8</span>
Milliseconds      : <span class="m">896</span>
Ticks             : <span class="m">88962891</span>
TotalDays         : 0.000102966309027778
TotalHours        : 0.00247119141666667
TotalMinutes      : 0.148271485
TotalSeconds      : 8.8962891
TotalMilliseconds : 8896.2891

PS C:<span class="se">\P</span>layground&gt; <span class="nv">$dns_recs</span>.Count
<span class="m">16</span>

<span class="c1"># Approach 2</span>
PS C:<span class="se">\P</span>layground&gt; Measure-Command <span class="o">{</span><span class="nv">$dns_recs_to_update</span> <span class="o">=</span> az network dns record-set a list -g test-rg -z dev.testzone.com --query <span class="s2">&#34;[].{Name:name, FQDN:fqdn, IP:aRecords[].ipv4Address}[?contains(IP[],&#39;192.0.2.146&#39;)]&#34;</span> <span class="p">|</span> ConvertFrom-Json<span class="o">}</span>

Days              : <span class="m">0</span>
Hours             : <span class="m">0</span>
Minutes           : <span class="m">0</span>
Seconds           : <span class="m">5</span>
Milliseconds      : <span class="m">736</span>
Ticks             : <span class="m">57361877</span>
TotalDays         : 6.63910613425926E-05
TotalHours        : 0.00159338547222222
TotalMinutes      : 0.0956031283333333
TotalSeconds      : 5.7361877
TotalMilliseconds : 5736.1877

PS C:<span class="se">\P</span>layground&gt; <span class="nv">$dns_recs_to_update</span>.Count
<span class="m">16</span></code></pre></div>
<p>As you can see, approach #2 is faster and the difference might not seem so significant here (3-4 seconds) but when you're creating a more advanced automation script where you might need to retrieve and refresh DNS records multiple times or when you need to perform maintenance on other types of Azure resources that have even more data to retrieve, the difference can get pretty significant. By utilizing the full potential of Azure CLI you can make your scripts more performant and optimized minimizing the footprint at the same time ;)</p>
<p><code>--query</code> syntax is based on a query language for JSON called JMESPath and you can familiarize yourself with it here: <a href="https://jmespath.org/">JMESPath</a>.</p>
<p>Check also this tutorial in Microsoft docs on how to write JMESPath-based queries as part of your Azure CLI command: <a href="https://docs.microsoft.com/en-us/cli/azure/query-azure-cli">How to query Azure CLI command output using a JMESPath query</a>.</p>
<p>Thanks for reading and till next tech tip ;)</p>
</div>
    <div class="post-footer">
      <div class="info">
        

        
          <span class="separator"><a class="tag" href="/tags/techtips/">techtips</a><a class="tag" href="/tags/azure/">azure</a><a class="tag" href="/tags/azure-cli/">azure-cli</a></span>




        
      </div>
    </div>

    
  </div>


          </div>
        </div>
      </main>
    </div><footer class="footer footer--base">
  <div class="by_farbox">
    <ul class="footer__list">
      <li class="footer__item">
        &copy;
        
          2022 - Powered by Hugo

        
      </li>
      
    </ul>
  </div>
</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.71100d84fab0ad794b8399a66ac810700cc78d703f715dc10af4d7ba7b761362.js"
    integrity="sha256-cRANhPqwrXlLg5mmasgQcAzHjXA/cV3BCvTXunt2E2I="
    crossorigin="anonymous"
  ></script>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-RJTQCDFS2Q', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-RJTQCDFS2Q"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());
  gtag('config', 'G-RJTQCDFS2Q');
</script>
</body>
</html>
