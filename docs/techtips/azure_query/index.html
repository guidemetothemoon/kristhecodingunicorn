<!DOCTYPE html>
<html
  dir="ltr"
  lang="en"
  data-theme="dark"
  
    class="html theme--dark"
  
><head>
  <title>
    Kris - The Coding Unicorn
        |
        Power of --query in Azure CLI
      

    

  </title>

  
  <meta charset="utf-8" /><meta name="generator" content="Hugo 0.117.0"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="author" content="Kris - The Coding Unicorn" />
  <meta
    name="description"
    content="Let&#39;s take a look at how helpful query parameter can be in Azure CLI."
  />
  
    <meta name="google-site-verification" content="OQXmc6vSYyn6I-aGZoI6GH2M6CdM4NjmwulDqvvNCQA" />
  
    
    
    <link
      rel="stylesheet"
      href="/scss/main.min.772eefee9824c26da5d3828c2507ea318c8e7a37b0b1d18cd4f224edc2755fea.css"
      integrity="sha256-dy7v7pgkwm2l04KMJQfqMYyOejewsdGM1PIk7cJ1X&#43;o="
      crossorigin="anonymous"
      type="text/css"
    />
  

  
  <link
    rel="stylesheet"
    href="/css/markupHighlight.min.73ccfdf28df555e11009c13c20ced067af3cb021504cba43644c705930428b00.css"
    integrity="sha256-c8z98o31VeEQCcE8IM7QZ688sCFQTLpDZExwWTBCiwA="
    crossorigin="anonymous"
    type="text/css"
  />
  
    
    
    <link
      rel="stylesheet"
      href="/css/syntax.min.dd17d6ee5bba73cc3f814469aae150232f0fc13a2038e79772f4d25565b5a23c.css"
      integrity="sha256-3RfW7lu6c8w/gURpquFQIy8PwTogOOeXcvTSVWW1ojw="
      crossorigin="anonymous"
      media="screen"
    />
  
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/fontawesome.min.7d272de35b410fb165377550cdf9c4d3a80fbbcc961e111914e4d5c0eaf5729f.css"
    integrity="sha256-fSct41tBD7FlN3VQzfnE06gPu8yWHhEZFOTVwOr1cp8="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/solid.min.55d8333481b07a08e07cf6f37319753a2b47e99f4c395394c5747b48b495aa9b.css"
    integrity="sha256-VdgzNIGwegjgfPbzcxl1OitH6Z9MOVOUxXR7SLSVqps="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/regular.min.a7448d02590b43449364b6b5922ed9af5410abb4de4238412a830316dedb850b.css"
    integrity="sha256-p0SNAlkLQ0STZLa1ki7Zr1QQq7TeQjhBKoMDFt7bhQs="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/brands.min.9ed75a5d670c953fe4df935937674b4646f92674367e9e66eb995bb04e821647.css"
    integrity="sha256-ntdaXWcMlT/k35NZN2dLRkb5JnQ2fp5m65lbsE6CFkc="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link rel="shortcut icon" href="/favicons/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png" />

  <link rel="canonical" href="https://kristhecodingunicorn.com/techtips/azure_query/" />

  
  
  
  
  <script
    type="text/javascript"
    src="/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js"
    integrity="sha256-&#43;RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI="
    crossorigin="anonymous"
  ></script>

  

  <script
  async
  defer
  src="https://umami-guidemetothemoon.vercel.app/18352c56e4b049f69a24fbae0ca62b4f.js"
  data-website-id="9dd30a0e-3918-4513-b61d-4dd81e20ed4b"
></script>



  
  <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://kristhecodingunicorn.com/images/site-feature-image.png"/>

<meta name="twitter:title" content="Power of --query in Azure CLI"/>
<meta name="twitter:description" content="Let&#39;s take a look at how helpful query parameter can be in Azure CLI."/>



  
  <meta property="og:title" content="Power of --query in Azure CLI" />
<meta property="og:description" content="Let&#39;s take a look at how helpful query parameter can be in Azure CLI." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kristhecodingunicorn.com/techtips/azure_query/" /><meta property="og:image" content="https://kristhecodingunicorn.com/images/site-feature-image.png"/><meta property="article:section" content="techtips" />
<meta property="article:published_time" content="2022-02-13T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-02-13T00:00:00+00:00" /><meta property="og:site_name" content="Kris - The Coding Unicorn" />



  
  
  
  
  <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "articleSection": "techtips",
        "name": "Power of --query in Azure CLI",
        "headline": "Power of --query in Azure CLI",
        "alternativeHeadline": "",
        "description": "
      Let\u0027s take a look at how helpful query parameter can be in Azure CLI.


    ",
        "inLanguage": "en",
        "isFamilyFriendly": "true",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/kristhecodingunicorn.com\/techtips\/azure_query\/"
        },
        "author" : {
            "@type": "Person",
            "name": "Kristina D."
        },
        "creator" : {
            "@type": "Person",
            "name": "Kristina D."
        },
        "accountablePerson" : {
            "@type": "Person",
            "name": "Kristina D."
        },
        "copyrightHolder" : {
            "@type": "Person",
            "name": "Kristina D."
        },
        "copyrightYear" : "2022",
        "dateCreated": "2022-02-13T00:00:00.00Z",
        "datePublished": "2022-02-13T00:00:00.00Z",
        "dateModified": "2022-02-13T00:00:00.00Z",
        "publisher":{
            "@type":"Organization",
            "name": "Kristina D.",
            "url": "https://kristhecodingunicorn.com",
            "logo": {
                "@type": "ImageObject",
                "url": "https:\/\/kristhecodingunicorn.com\/favicons\/favicon-32x32.png",
                "width":"32",
                "height":"32"
            }
        },
        "image": 
      [
        
        "https://kristhecodingunicorn.com/images/site-feature-image.png"


      
      ]

    ,
        "url" : "https:\/\/kristhecodingunicorn.com\/techtips\/azure_query\/",
        "wordCount" : "537",
        "genre" : [ ],
        "keywords" : [ 
      
      "techtips"

    
      
        ,

      
      "azure"

    
      
        ,

      
      "azure-cli"

    ]
    }
  </script>


</head>
<body class="body">
    <div class="wrapper">
      <aside
        
          class="wrapper__sidebar"
        
      ><div
  class="sidebar
    animated fadeInDown
  "
>
  <div class="sidebar__content">
    <div class="sidebar__introduction">
      <img
        class="sidebar__introduction-profileimage"
        src="/images/profile.webp"
        alt="profile picture"
      />
      
        <div class="sidebar__introduction-title">
          <a href="/">Kris - The Coding Unicorn</a>
        </div>
      
      <div class="sidebar__introduction-description">
        <p>Welcome to my tech corner! ü§ó <br />I preach about all things cloud native, green tech and cats üêà <br />Check "Blog" for new posts and "About" for my community involvement ü¶Ñ</p>
      </div>
    </div>
    <ul class="sidebar__list">
      
        <li class="sidebar__list-item">
          <a
            href="https://linkfree.io/guidemetothemoon"
            target="_blank"
            rel="noopener me"
            aria-label="Let&#39;s connect!"
            title="Let&#39;s connect!"
          >
            <i class="fas fa-cat fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      
        <li class="sidebar__list-item">
          <a
            href="https://www.buymeacoffee.com/kristhecodingu1"
            target="_blank"
            rel="noopener me"
            aria-label="Help me buy supplies for homeless animals &lt;3"
            title="Help me buy supplies for homeless animals &lt;3"
          >
            <i class="fas fa-hand-holding-heart fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      
        <li class="sidebar__list-item">
          <a
            href="https://feedly.com/i/subscription/feed%2Fhttps%3A%2F%2Fkristhecodingunicorn.com%2Findex.xml"
            target="_blank"
            rel="noopener me"
            aria-label="RSS feed"
            title="RSS feed"
          >
            <i class="fas fa-rss fa-2x" aria-hidden="true"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    <div id="wcb"  
        
        class="carbonbadge wcb-d"
        
    >
    </div>
    <script src="https://unpkg.com/website-carbon-badges@1.1.3/b.min.js" defer></script>
  <footer class="footer footer__sidebar">
  <ul class="footer__list">
    <li class="footer__item">
      &copy;
      
        2023 - Powered by Hugo
      
    </li>
    
  </ul>
</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js"
    integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ="
    crossorigin="anonymous"
  ></script></div>
</aside>
      <main
        
          class="wrapper__main"
        
      >
        <header class="header"><div
  class="
    animated fadeInDown
  "
>
  <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
    <span aria-hidden="true" class="navbar-burger__line"></span>
    <span aria-hidden="true" class="navbar-burger__line"></span>
    <span aria-hidden="true" class="navbar-burger__line"></span>
  </a>
  <nav class="nav">
    <ul class="nav__list" id="navMenu">
      
      
        
        
          <li class="nav__list-item">
            
            <a
              
              href="/"
              
              title=""
              >Home</a
            >
          </li>
        

      
        
        
          <li class="nav__list-item">
            
            <a
              
              href="/post/"
              
              title=""
              >Blog</a
            >
          </li>
        

      
        
        
          <li class="nav__list-item">
            
            <a
              
              href="/techtips/"
              
              title=""
              >Tech Tips</a
            >
          </li>
        

      
        
        
          <li class="nav__list-item">
            
            <a
              
              href="/public/"
              
              title=""
              >Public Talks and Publications</a
            >
          </li>
        

      
        
        
          <li class="nav__list-item">
            
            <a
              
              href="/about/"
              
              title=""
              >About</a
            >
          </li>
        

      
        
        
          <li class="nav__list-item">
            
            <a
              
              href="/contact/"
              
              title=""
              >Contact</a
            >
          </li>
        

      
    </ul>
    <ul class="nav__list nav__list--end">
      
      
    </ul>
  </nav>
</div>
</header>
  <div
    class="post 
      animated fadeInDown
    "
  >
    
    <div class="post__content">
      <h1>Power of --Query in Azure CLI</h1>
      <p>Have you ever heard of or used query parameter when running Azure CLI commands? If not, I do recommend you checking it out because this is a pretty powerful parameter that can help you with much faster and efficient data retrieval and filtering!
Let's use DNS records retrieval as an example: I need to update DNS records pointing to a specific IP, f.ex. <code>192.0.2.146</code>.</p>
<p>So, in order to retrieve all DNS records in respective DNS zone pointing to <code>192.0.2.146</code> with Azure CLI I could either:</p>
<ol>
<li>Retrieve all records registered in respective DNS zone and save them to a variable from which I can filter out only those records pointing to my IP.</li>
<li>Use <code>--query</code> parameter to retrieve only the DNS records pointing to my IP instead of retrieving all of the records at once.</li>
</ol>
<p>Let's see the execution time differences for both - I will use <code>Measure-Command</code> to measure the time it take to execute each of the approaches. The DNS zone I will be testing against has <strong>64 713</strong> records and I will be replacing real values with dummy ones in the test below since it's real name and IP are being used in production :)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c">#Command for approach 1:</span>
</span></span><span class="line"><span class="cl"><span class="nb">Measure-Command</span> <span class="p">{</span> <span class="nv">$dns_list</span> <span class="p">=</span> <span class="n">az</span> <span class="n">network</span> <span class="n">dns</span> <span class="nb">record-set</span> <span class="n">a</span> <span class="n">list</span> <span class="n">-g</span> <span class="nb">test-rg</span> <span class="n">-z</span> <span class="n">dev</span><span class="p">.</span><span class="py">testzone</span><span class="p">.</span><span class="n">com</span><span class="p">;</span> <span class="nv">$dns_recs</span> <span class="p">=</span> <span class="nv">$dns_list</span> <span class="p">`</span> 
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="nb">ConvertFrom-Json</span> <span class="n">-Depth</span> <span class="mf">4</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="py">arecords</span><span class="p">.</span><span class="py">ipv4Address</span> <span class="o">-eq</span> <span class="s2">&#34;192.0.2.146&#34;</span><span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Command for approach 2:</span>
</span></span><span class="line"><span class="cl"><span class="nb">Measure-Command</span> <span class="p">{</span> <span class="nv">$dns_recs_to_update</span> <span class="p">=</span> <span class="n">az</span> <span class="n">network</span> <span class="n">dns</span> <span class="nb">record-set</span> <span class="n">a</span> <span class="n">list</span> <span class="n">-g</span> <span class="nb">test-rg</span> <span class="n">-z</span> <span class="n">dev</span><span class="p">.</span><span class="py">testzone</span><span class="p">.</span><span class="py">com</span> <span class="p">`</span> 
</span></span><span class="line"><span class="cl"><span class="p">-</span><span class="n">-query</span> <span class="s2">&#34;[].{Name:name, FQDN:fqdn, IP:aRecords[].ipv4Address}[?contains(IP[], &#39;192.0.2.146&#39;)]&#34;</span> <span class="p">`</span> 
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="nb">ConvertFrom-Json</span> <span class="p">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># Approach 1
</span></span><span class="line"><span class="cl">PS C:\Playground&gt; Measure-Command {$dns_list = az network dns record-set a list -g test-rg -z dev.testzone.com; $dns_recs = $dns_list | ConvertFrom-Json -Depth 4 | Where-Object {$_.arecords.ipv4Address -eq &#34;192.0.2.146&#34;}}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Days              : 0
</span></span><span class="line"><span class="cl">Hours             : 0
</span></span><span class="line"><span class="cl">Minutes           : 0
</span></span><span class="line"><span class="cl">Seconds           : 8
</span></span><span class="line"><span class="cl">Milliseconds      : 896
</span></span><span class="line"><span class="cl">Ticks             : 88962891
</span></span><span class="line"><span class="cl">TotalDays         : 0.000102966309027778
</span></span><span class="line"><span class="cl">TotalHours        : 0.00247119141666667
</span></span><span class="line"><span class="cl">TotalMinutes      : 0.148271485
</span></span><span class="line"><span class="cl">TotalSeconds      : 8.8962891
</span></span><span class="line"><span class="cl">TotalMilliseconds : 8896.2891
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PS C:\Playground&gt; $dns_recs.Count
</span></span><span class="line"><span class="cl">16
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Approach 2
</span></span><span class="line"><span class="cl">PS C:\Playground&gt; Measure-Command {$dns_recs_to_update = az network dns record-set a list -g test-rg -z dev.testzone.com --query &#34;[].{Name:name, FQDN:fqdn, IP:aRecords[].ipv4Address}[?contains(IP[],&#39;192.0.2.146&#39;)]&#34; | ConvertFrom-Json}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Days              : 0
</span></span><span class="line"><span class="cl">Hours             : 0
</span></span><span class="line"><span class="cl">Minutes           : 0
</span></span><span class="line"><span class="cl">Seconds           : 5
</span></span><span class="line"><span class="cl">Milliseconds      : 736
</span></span><span class="line"><span class="cl">Ticks             : 57361877
</span></span><span class="line"><span class="cl">TotalDays         : 6.63910613425926E-05
</span></span><span class="line"><span class="cl">TotalHours        : 0.00159338547222222
</span></span><span class="line"><span class="cl">TotalMinutes      : 0.0956031283333333
</span></span><span class="line"><span class="cl">TotalSeconds      : 5.7361877
</span></span><span class="line"><span class="cl">TotalMilliseconds : 5736.1877
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PS C:\Playground&gt; $dns_recs_to_update.Count
</span></span><span class="line"><span class="cl">16
</span></span></code></pre></div><p>As you can see, approach #2 is faster and the difference might not seem so significant here (3-4 seconds) but when you're creating a more advanced automation script where you might need to retrieve and refresh DNS records multiple times or when you need to perform maintenance on other types of Azure resources that have even more data to retrieve, the difference can get pretty significant. By utilizing the full potential of Azure CLI you can make your scripts more performant and optimized minimizing the footprint at the same time ;)</p>
<p><code>--query</code> syntax is based on a query language for JSON called JMESPath and you can familiarize yourself with it here: <a href="https://jmespath.org/">JMESPath</a>.</p>
<p>Check also this tutorial in Microsoft docs on how to write JMESPath-based queries as part of your Azure CLI command: <a href="https://docs.microsoft.com/en-us/cli/azure/query-azure-cli">How to query Azure CLI command output using a JMESPath query</a>.</p>
<p>Thanks for reading and till next tech tip ;)</p>
</div>
    <div class="post__footer">
      

      
        <span><a class="tag" href="/tags/techtips/">techtips</a><a class="tag" href="/tags/azure/">azure</a><a class="tag" href="/tags/azure-cli/">azure-cli</a></span>


      
    </div>

    
  </div>

      </main>
    </div><footer class="footer footer__base">
  <ul class="footer__list">
    <li class="footer__item">
      &copy;
      
        2023 - Powered by Hugo
      
    </li>
    
  </ul>
</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js"
    integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ="
    crossorigin="anonymous"
  ></script></body>
</html>
