<!DOCTYPE html>
<html
  dir="ltr"
  lang="en"
  data-theme="dark"
  class="html"
><head>
  <title>
    
      Kris - The Coding Unicorn
        |
        Kris&#39;s Quick Cup of (A)K8S #4 - HTTP Application Routing add-on in AKS


      


    
  </title>

  
  <meta charset="utf-8" /><meta name="generator" content="Hugo 0.92.2" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="author" content="Kris - The Coding Unicorn" />
  <meta
    name="description"
    content="
      In this tech tip we look at how we can easily expose applications running in AKS in dev/test with HTTP Application Routing add-on.


    "
  />
  
    <meta name="google-site-verification" content="OQXmc6vSYyn6I-aGZoI6GH2M6CdM4NjmwulDqvvNCQA" />
  
    
    
    <link
      rel="stylesheet"
      href="/scss/main.min.b2e0cb07595e3519ab1193bb421914e06c0e26b0cc561fef23b3c6131d4d2ffa.css"
      integrity="sha256-suDLB1leNRmrEZO7QhkU4GwOJrDMVh/vI7PGEx1NL/o="
      crossorigin="anonymous"
      type="text/css"
    />

  

  
  <link
    rel="stylesheet"
    href="/css/markupHighlight.min.31b0a1f317f55c529a460897848c97436bb138b19c399b37de70d463a8bf6ed5.css"
    integrity="sha256-MbCh8xf1XFKaRgiXhIyXQ2uxOLGcOZs33nDUY6i/btU="
    crossorigin="anonymous"
    type="text/css"
  />
  
    
    
    <link
      rel="stylesheet"
      href="/css/syntax.min.dd17d6ee5bba73cc3f814469aae150232f0fc13a2038e79772f4d25565b5a23c.css"
      integrity="sha256-3RfW7lu6c8w/gURpquFQIy8PwTogOOeXcvTSVWW1ojw="
      crossorigin="anonymous"
      media="screen"
    />

  
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/fontawesome.min.b1c4e6a10bdbab01f33fff9d78816ee68cf9a9a731f07668afd546a79924cb80.css"
    integrity="sha256-scTmoQvbqwHzP/&#43;deIFu5oz5qacx8HZor9VGp5kky4A="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/solid.min.423dee17c62f55fa733a4ee13e00d523dfce88cc4f4ab4549a24ba36bd9de681.css"
    integrity="sha256-Qj3uF8YvVfpzOk7hPgDVI9/OiMxPSrRUmiS6Nr2d5oE="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/brands.min.b7d54133b27e5b4de15245b8e143de3e8ed2d674c706137274cedc9953f31917.css"
    integrity="sha256-t9VBM7J&#43;W03hUkW44UPePo7S1nTHBhNydM7cmVPzGRc="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link rel="shortcut icon" href="/favicons/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png" />

  <link rel="canonical" href="https://kristhecodingunicorn.com/techtips/kris_daily_k8s_4/" />

  
  
  
  
  <script
    type="text/javascript"
    src="/js/anatole-header.min.46e6a54097480084f8f52c20ca1aa7425b4fad17029a887fd4017b12e311a72d.js"
    integrity="sha256-RualQJdIAIT49SwgyhqnQltPrRcCmoh/1AF7EuMRpy0="
    crossorigin="anonymous"
  ></script>

  

  


  
  <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://kristhecodingunicorn.com/images/site-feature-image.png"/>

<meta name="twitter:title" content="Kris&#39;s Quick Cup of (A)K8S #4 - HTTP Application Routing add-on in AKS"/>
<meta name="twitter:description" content="In this tech tip we look at how we can easily expose applications running in AKS in dev/test with HTTP Application Routing add-on."/>



  
  <meta property="og:title" content="Kris&#39;s Quick Cup of (A)K8S #4 - HTTP Application Routing add-on in AKS" />
<meta property="og:description" content="In this tech tip we look at how we can easily expose applications running in AKS in dev/test with HTTP Application Routing add-on." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kristhecodingunicorn.com/techtips/kris_daily_k8s_4/" /><meta property="og:image" content="https://kristhecodingunicorn.com/images/site-feature-image.png"/><meta property="article:section" content="techtips" />
<meta property="article:published_time" content="2022-09-26T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-09-26T00:00:00+00:00" /><meta property="og:site_name" content="Kris - The Coding Unicorn" />




  
  
  
  
  <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "articleSection": "techtips",
        "name": "Kris\u0027s Quick Cup of (A)K8S #4 - HTTP Application Routing add-on in AKS",
        "headline": "Kris\u0027s Quick Cup of (A)K8S #4 - HTTP Application Routing add-on in AKS",
        "alternativeHeadline": "",
        "description": "
      In this tech tip we look at how we can easily expose applications running in AKS in dev\/test with HTTP Application Routing add-on.


    ",
        "inLanguage": "en",
        "isFamilyFriendly": "true",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/kristhecodingunicorn.com\/techtips\/kris_daily_k8s_4\/"
        },
        "author" : {
            "@type": "Person",
            "name": "Kristina D."
        },
        "creator" : {
            "@type": "Person",
            "name": "Kristina D."
        },
        "accountablePerson" : {
            "@type": "Person",
            "name": "Kristina D."
        },
        "copyrightHolder" : {
            "@type": "Person",
            "name": "Kristina D."
        },
        "copyrightYear" : "2022",
        "dateCreated": "2022-09-26T00:00:00.00Z",
        "datePublished": "2022-09-26T00:00:00.00Z",
        "dateModified": "2022-09-26T00:00:00.00Z",
        "publisher":{
            "@type":"Organization",
            "name": "Kristina D.",
            "url": "https://kristhecodingunicorn.com",
            "logo": {
                "@type": "ImageObject",
                "url": "https:\/\/kristhecodingunicorn.com\/favicons\/favicon-32x32.png",
                "width":"32",
                "height":"32"
            }
        },
        "image": 
      [
        
        "https://kristhecodingunicorn.com/images/site-feature-image.png"


      
      ]

    ,
        "url" : "https:\/\/kristhecodingunicorn.com\/techtips\/kris_daily_k8s_4\/",
        "wordCount" : "737",
        "genre" : [ ],
        "keywords" : [ 
      
      "techtips"

    
      
        ,

      
      "azure"

    
      
        ,

      
      "aks"

    
      
        ,

      
      "kubernetes"

    
      
        ,

      
      "gitops"

    ]
    }
  </script>



</head>
<body
    
      class="body theme--dark"

    
  >
    <div class="wrapper">
      <aside
        
          class="wrapper__sidebar"

        
      ><div
  class="sidebar
    animated fadeInDown

  "
>
  <div class="sidebar__content">
    <div class="sidebar__introduction">
      <img
        class="sidebar__introduction-profileimage"
        src="/images/profile.jpg"
        alt="profile picture"
      />
      
        <div class="sidebar__introduction-title">
          <a href="/">Kris - The Coding Unicorn</a>
        </div>

      
      <div class="sidebar__introduction-description">
        <p>Hey! I'm Kris and I like to code. Welcome to my tech corner!ü§ó <br /> Azure Hero and Microsoft Azure MVP‚õÖÔ∏è | Open-Sourceressüßôüèª‚Äç‚ôÄÔ∏è | Volunteerü¶æ | <br /> Cat Mom üêàüêàüêà and Potterhead</p>
      </div>
    </div>
    <ul class="sidebar__list">
      
        <li class="sidebar__list-item">
          <a
            href="https://www.linkedin.com/in/krisde"
            target="_blank"
            rel="noopener"
            aria-label="Linkedin"
            title="Linkedin"
          >
            <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
        <li class="sidebar__list-item">
          <a
            href="https://github.com/guidemetothemoon"
            target="_blank"
            rel="noopener"
            aria-label="GitHub"
            title="GitHub"
          >
            <i class="fab fa-github fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
        <li class="sidebar__list-item">
          <a
            href="https://twitter.com/kristhecodingu1"
            target="_blank"
            rel="noopener"
            aria-label="Twitter"
            title="Twitter"
          >
            <i class="fab fa-twitter fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
        <li class="sidebar__list-item">
          <a
            href="https://sessionize.com/kristina-devochko"
            target="_blank"
            rel="noopener"
            aria-label="Sessionize"
            title="Sessionize"
          >
            <i class="fas fa-bullhorn fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
        <li class="sidebar__list-item">
          <a
            href="https://www.instagram.com/guidemetothemoon"
            target="_blank"
            rel="noopener"
            aria-label="instagram"
            title="instagram"
          >
            <i class="fab fa-instagram fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
        <li class="sidebar__list-item">
          <a
            href="/contact/"
            target="_blank"
            rel="noopener"
            aria-label="e-mail"
            title="e-mail"
          >
            <i class="fas fa-envelope fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
        <li class="sidebar__list-item">
          <a
            href="https://feedly.com/i/subscription/feed%2Fhttps%3A%2F%2Fkristhecodingunicorn.com%2Findex.xml"
            target="_blank"
            rel="noopener"
            aria-label="rss"
            title="rss"
          >
            <i class="fas fa-rss fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
        <li class="sidebar__list-item">
          <a
            href="https://www.azureheroes.community/user/15391"
            target="_blank"
            rel="noopener"
            aria-label="Azure Heroes"
            title="Azure Heroes"
          >
            <i class="fas fa-mask fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
        <li class="sidebar__list-item">
          <a
            href="https://mvp.microsoft.com/en-us/PublicProfile/5004929?fullName=Kristina%20Devochko"
            target="_blank"
            rel="noopener"
            aria-label="Microsoft MVP"
            title="Microsoft MVP"
          >
            <i class="fas fa-cloud fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
    </ul>
  </div><footer class="footer footer__sidebar">
  <ul class="footer__list">
    <li class="footer__item">
      &copy;
      
        2022 - Powered by Hugo

      
    </li>
    
  </ul>
</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.fae9ac8895995fe91958b3954be11e96025824a04770726a3531e119ddd2d576.js"
    integrity="sha256-&#43;umsiJWZX&#43;kZWLOVS&#43;EelgJYJKBHcHJqNTHhGd3S1XY="
    crossorigin="anonymous"
  ></script></div>
</aside>
      <main
        
          class="wrapper__main"

        
      >
        <header class="header"><div
  class="
    animated fadeInDown

  "
>
  <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
    <span aria-hidden="true" class="navbar-burger__line"></span>
    <span aria-hidden="true" class="navbar-burger__line"></span>
    <span aria-hidden="true" class="navbar-burger__line"></span>
  </a>
  <nav class="nav">
    <ul class="nav__list" id="navMenu">
      
      
      
        
        
          <li class="nav__list-item">
            <a
              
              href="/"
              
              title=""
              >Home</a
            >
          </li>

        


      
        
        
          <li class="nav__list-item">
            <a
              
              href="/post/"
              
              title=""
              >Blog</a
            >
          </li>

        


      
        
        
          <li class="nav__list-item">
            <a
              
              href="/techtips/"
              
              title=""
              >Tech Tips</a
            >
          </li>

        


      
        
        
          <li class="nav__list-item">
            <a
              
              href="/public/"
              
              title=""
              >Public Talks and Publications</a
            >
          </li>

        


      
        
        
          <li class="nav__list-item">
            <a
              
              href="/about/"
              
              title=""
              >About</a
            >
          </li>

        


      
        
        
          <li class="nav__list-item">
            <a
              
              href="/contact/"
              
              title=""
              >Contact</a
            >
          </li>

        


      
    </ul>
    <ul class="nav__list nav__list--end">
      
      
    </ul>
  </nav>
</div>
</header>
  <div
    class="post 
      animated fadeInDown

    "
  >
    
    <div class="post__content">
      <h1>Kris&#39;s Quick Cup of (A)K8S #4 - HTTP Application Routing Add-on in AKS</h1>
      <p><img src="../../images/tech_tips/techtip_13.png" alt="Article banner for Kris&rsquo;s quick cup of K8s number 4"></p>
<p>Normally if you were to expose an application running in AKS for external access, you would need multiple bits and pieces to be deployed and configured:</p>
<ul>
<li><strong>Ingress Controller</strong> to ensure proper traffic routing and load balancing in an AKS cluster;</li>
<li><strong>Certificate management solution</strong> for automatic obtaining, provisioning, renewing and using of TLS certificates for applications running in AKS clusters;</li>
<li><strong>DNS zone and respective DNS records</strong> to expose applications on a specific URL for external access;</li>
</ul>
<p>This can be quite a lot to set up and will in some cases be an overhead for dev/test or playground AKS clusters. That&rsquo;s when HTTP Application Routing add-on can help you out and do all this work for you! üöÄ</p>
<blockquote>
<p>‚õîÔ∏è HTTP Application Routing add-on is supposed to only be used for dev/test purposes and <strong>must not be used in production</strong>! It will not provide any TLS encryption or security filtering for your applications!</p>
</blockquote>
<p>HTTP Application Routing is an add-on that you can enable both for new and existing AKS clusters. Once it&rsquo;s enabled, it will automatically configure an Ingress Controller and DNS zone for the respective cluster. It will also automatically provision a DNS A record in the DNS zone for applications that are to be exposed based on a specific Ingress annotation.</p>
<p>Let&rsquo;s take a look at a concrete example: I would like to expose a <strong>&ldquo;cat-encyclopedia&rdquo;</strong> application running in my <strong>&ldquo;chamber-of-secrets&rdquo;</strong> AKS cluster for external access so that I can experiment with it and run some cool demos that others can also test - how can I quickly do that with help of HTTP Application Routing add-on?</p>
<ol>
<li>Enable HTTP Application Routing add-on for &ldquo;chamber-of-secrets&rdquo; AKS cluster:
<code>az aks enable-addons --resource-group aks-sp-demo --name chamber-of-secrets --addons http_application_routing</code></li>
</ol>
<blockquote>
<p>You can also enable HTTP Application Routing add-on as part of a new AKS cluster creation: <code>az aks create --resource-group aks-sp-demo --name chamber-of-secrets --enable-addons http_application_routing</code></p>
</blockquote>
<p>Check if the add-on was successfully enabled in &ldquo;chamber-of-secrets&rdquo; AKS cluster:</p>
<p><code>az aks addon list --name chamber-of-secrets --resource-group aks-sp-demo | jq '.[] | select(.name==&quot;http_application_routing&quot;)'</code></p>
<ol start="2">
<li>Check the name of the DNS Zone that was provisioned for &ldquo;chamber-of-secrets&rdquo; AKS cluster. DNS Zone is deployed to the infrastructure resource group of your AKS cluster so please ensure that you&rsquo;re providing a correct resource group for this Azure CLI command: <code>az network dns zone list --resource-group MC_aks-sp-demo_chamber-of-secrets_northeurope</code>. You can also check the same in Azure Portal, by going to &ldquo;DNS Zones&rdquo; and locating the DNS Zone that was provisioned to the same resource group as the AKS cluster infrastructure resources.</li>
</ol>
<p><img src="../../images/tech_tips/aks_addon_dns_zone.png" alt="Screenshot of DNS Zone created by HTTP Application Routing add-on in Azure Portal"></p>
<ol start="3">
<li>Add annotation to &ldquo;cat-encyclopedia&rdquo; Ingress resource definition that will flag this application for HTTP Application Routing add-on. Add host URL that you want to expose application on. Host URL consists of application name (or other name that you want to expose application with) + DNS Zone created by HTTP Application Routing add-on.</li>
</ol>
<p>In this case host will be <code>cat-encyclopedia.[AKS_DNS_ZONE]</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">networking.k8s.io/v1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Ingress</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cat-encyclopedia</span><span class="w">
</span><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">cat-encyclopedia</span><span class="w">
</span><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span><span class="w"> </span><span class="l">addon-http-application-routing</span><span class="w"> </span><span class="c"># &lt;- add this annotation to flag the app for HTTP Application Routing add-on</span><span class="w">
</span><span class="w">    </span><span class="c"># OTHER ANNOTATIONS ARE OMITTED</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l">cat-encyclopedia.a108aa453388426da88c.northeurope.aksapp.io</span><span class="w"> </span><span class="c"># &lt;- update this property with your application&#39;s host URL</span><span class="w">
</span><span class="w">    </span><span class="nt">http</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">backend</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">service</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="c"># REST OF THE CODE IS OMITTED</span><span class="w">
</span></code></pre></div><p>And voil√†! Your application is now publicly accessible on <code>cat-encyclopedia.a108aa453388426da88c.northeurope.aksapp.io</code> URL! If I now go to <code>http://cat-encyclopedia.a108aa453388426da88c.northeurope.aksapp.io</code> in a browser, I can see my app up and running, ready to be demoed to the world!üò∫</p>
<p><img src="../../images/tech_tips/aks-addon-onlineapp.png" alt="Screenshot of application that is publicly exposed with help of HTTP Application Routing add-on"></p>
<blockquote>
<p>Sometimes it may take a while (up to 10-15 minutes in some cases, from my experience) for an application to be reachable on a configured DNS record so if you get a <strong>&ldquo;We‚Äôre having trouble finding that site.&quot;</strong> error when accessing an application, just give it a few more minutes before re-trying. If the error still persists, you can debug eventual errors by following documentation from Microsoft: <a href="https://learn.microsoft.com/en-us/azure/aks/http-application-routing#troubleshoot">HTTP Application Routing - Troubleshoot</a></p>
</blockquote>
<p>Once you delete an AKS cluster, all the resources provisioned by HTTP Application Routing add-on will be deleted for you. The same will happen if you disable the add-on but in this case some resources like Secrets and ConfigMaps may still persist in the cluster. You can check if there are any resources that haven&rsquo;t been cleaned up by running following kubectl command: <code>kubectl get all,cm,secrets -A | grep &quot;addon-http-application-routing*&quot;</code></p>
<p><img src="../../images/tech_tips/aks_addon_getallcmd.png" alt="Screenshot of getting all deployed resources for HTTP Application Routing add-on in AKS cluster with kubectl command"></p>
<p>HTTP Application Routing can save you quite some time during development and testing, try it out for yourself and let me know what you think! Check out documentation from Microsoft about this add-on as well: <a href="https://learn.microsoft.com/en-us/azure/aks/http-application-routing">HTTP application routing</a></p>
<p>That's it for now - Thanks for reading and till next tech tip üòº</p>
</div>
    <div class="post__footer">
      

      
        <span><a class="tag" href="/tags/techtips/">techtips</a><a class="tag" href="/tags/azure/">azure</a><a class="tag" href="/tags/aks/">aks</a><a class="tag" href="/tags/kubernetes/">kubernetes</a><a class="tag" href="/tags/gitops/">gitops</a></span>




      
    </div>

    
  </div>


      </main>
    </div><footer class="footer footer__base">
  <ul class="footer__list">
    <li class="footer__item">
      &copy;
      
        2022 - Powered by Hugo

      
    </li>
    
  </ul>
</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.fae9ac8895995fe91958b3954be11e96025824a04770726a3531e119ddd2d576.js"
    integrity="sha256-&#43;umsiJWZX&#43;kZWLOVS&#43;EelgJYJKBHcHJqNTHhGd3S1XY="
    crossorigin="anonymous"
  ></script></body>
</html>
